# Feature Specification: 研發檢驗單管理

**Feature Branch**: `002-inspection-record-management`
**Created**: 2025-11-10
**Updated**: 2025-11-11
**Status**: UI Implementation Completed
**Input**: User description: "研發檢驗單管理：紀錄樣品檢測（首測、複測），保存檢驗數據，支援送樣管理、業務樣本分配與多條件查詢"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 建立檢驗單（首測） (Priority: P1)

研發人員完成配方後，需要對樣品進行首次檢測時，能夠選擇配方版本（如 v3）並建立檢驗單，系統自動帶入配方建立者資訊，填寫首測必填資料（外觀/重量、濃度 Brix%、酸鹼 PH、實地口感評分、成品飲料測試等），指定檢驗人員，並可透過送樣按鈕送樣給多個業務（每個業務指定樣本數量），系統保存完整檢驗紀錄。

**Why this priority**: 這是檢驗管理的核心功能，研發流程中必須記錄首測數據、送樣資訊和樣本分配以追蹤產品品質。這是 MVP 的基礎。

**Independent Test**: 研發人員可以登入系統，選擇已核准的配方版本，建立檢驗單，輸入首測日期和所有檢測項目（外觀/重量、Brix、PH、感官品評等），上傳照片後送出，系統顯示提交成功訊息。可以在檢驗單列表中看到剛建立的檢驗單。

**Acceptance Scenarios**:

1. **Given** 研發人員已登入系統，**When** 點擊「建立檢驗單」按鈕，**Then** 系統顯示配方版本選擇畫面，列出所有已核准的配方版本
2. **Given** 研發人員選擇特定配方版本（例如：紅豆湯 v3），**When** 確認選擇，**Then** 系統開啟檢驗單建立表單，自動帶入配方資訊（產品名稱、版本號）和填表人基本資料（部門、姓名）
3. **Given** 研發人員在檢驗單表單中填寫首測資訊，**When** 輸入首測日期、外觀/重量(必填)、Brix%(必填)、PH值(必填)、實地口感評分(range input 滑桿 1-10 分, 必填)、成品飲料測試(必填)、選擇檢驗人員(必填)，並可在業務樣本分配表格中指定送樣業務和數量，**Then** 系統驗證資料完整性
4. **Given** 研發人員填寫完整首測資訊，**When** 點擊「儲存檢驗單」按鈕，**Then** 系統儲存檢驗單並標記為「首測完成(未送樣)」或「首測完成(已送樣)」狀態（依是否送樣），顯示成功訊息
5. **Given** 檢驗單已成功儲存，**When** 研發人員查看檢驗單列表，**Then** 系統顯示剛建立的檢驗單及其狀態，並可看到送樣狀態欄位

---

### User Story 2 - 補充十天後測數據 (Priority: P1)

研發人員或品管人員需要在首測後十天補充檢測數據時，能夠找到該檢驗單並輸入十天後測的所有檢測項目（日期、外觀/重量、Brix%、PH值、感官品評、出水率/固形物、成品飲料測試、照片上傳、備註、規格、規格單位），系統保存完整的兩階段檢驗紀錄。

**Why this priority**: 十天後測是研發檢驗的必要流程，用於觀察樣品保存後的品質變化。沒有此功能，檢驗流程不完整。

**Independent Test**: 研發人員可以在檢驗單列表中找到「首測完成(未送樣)」或「首測完成(已送樣)」的檢驗單，點擊「補充十天後測」，輸入十天後測日期和所有檢測項目（使用 range input 滑桿輸入實地口感評分），上傳照片後送出，系統更新檢驗單狀態為「十天檢測完成」。

**Acceptance Scenarios**:

1. **Given** 研發人員查看檢驗單列表，**When** 篩選「首測完成(未送樣)」或「首測完成(已送樣)」狀態，**Then** 系統顯示所有待補充十天後測的檢驗單
2. **Given** 研發人員點擊某個首測完成的檢驗單，**When** 點擊「補充十天後測」按鈕，**Then** 系統開啟十天後測表單，顯示首測資訊（唯讀）和十天後測輸入區域
3. **Given** 研發人員在十天後測表單中填寫資訊，**When** 輸入十天後測日期、外觀/重量、Brix%、PH值、實地口感評分(range input 滑桿 1-10 分)、出水率/固形物、成品飲料測試、規格、規格單位、備註，並上傳照片，**Then** 系統驗證資料完整性
4. **Given** 研發人員填寫完整十天後測資訊，**When** 點擊「儲存檢驗單」按鈕，**Then** 系統更新檢驗單並標記為「十天檢測完成」狀態，顯示成功訊息
5. **Given** 檢驗單已完成兩階段檢測，**When** 查看檢驗單詳情，**Then** 系統並排顯示首測和十天後測的所有資料，方便對比

---

### User Story 3 - 查詢與檢視檢驗單 (Priority: P2)

研發人員和品管人員需要快速找到特定檢驗單時，能夠使用多個條件篩選（配方名稱、版本號、填表人、日期範圍、狀態等），系統即時顯示符合條件的檢驗單列表，並可檢視完整檢驗資料。

**Why this priority**: 查詢功能提升使用者體驗，但在檢驗單數量較少時，基本的列表瀏覽也能滿足需求。這是優化功能而非核心功能。

**Independent Test**: 使用者可以在檢驗單列表頁面輸入篩選條件（例如：配方名稱包含「紅豆湯」、狀態為「十天檢測完成」、日期範圍為最近一個月），點擊「查詢」後看到符合條件的檢驗單列表。

**Acceptance Scenarios**:

1. **Given** 使用者在檢驗單列表頁面，**When** 在篩選區塊輸入配方名稱關鍵字（例如「紅豆湯」），**Then** 系統即時顯示名稱包含該關鍵字的檢驗單
2. **Given** 使用者選擇特定狀態篩選條件（可選：未檢測、首測完成(未送樣)、首測完成(已送樣)、十天檢測完成、狀態異常），**When** 點擊「查詢」按鈕，**Then** 系統顯示符合條件的檢驗單
3. **Given** 使用者選擇日期範圍（2025-01-01 到 2025-03-31）和填表人組合條件，**When** 點擊「查詢」，**Then** 系統顯示符合所有條件的檢驗單列表
4. **Given** 使用者點擊某個檢驗單，**When** 進入檢驗單詳情頁面，**Then** 系統顯示完整檢驗資料（配方資訊、填表人資訊、首測數據、十天後測數據、照片、備註）
5. **Given** 使用者已套用篩選條件，**When** 點擊「清除篩選」按鈕，**Then** 系統重置所有篩選條件並顯示完整檢驗單列表

---

### User Story 4 - 品管人員協同檢驗 (Priority: P3)

品管人員需要協助研發人員進行檢驗時，能夠查看所有檢驗單、補充十天後測數據，並在檢驗單中留下品管意見，確保檢驗流程的專業性和完整性。

**Why this priority**: 品管協同是流程優化功能，初期可由研發人員獨立完成檢驗，後期再開放品管協作以提升效率。

**Independent Test**: 品管人員可以登入系統，查看所有檢驗單，篩選「首測完成(未送樣)」或「首測完成(已送樣)」狀態，補充十天後測數據，並在備註欄位填寫品管意見，儲存後檢驗單狀態更新為「十天檢測完成」。

**Acceptance Scenarios**:

1. **Given** 品管人員已登入系統，**When** 進入檢驗單列表頁面，**Then** 系統顯示所有檢驗單（包含其他研發人員建立的檢驗單）
2. **Given** 品管人員篩選「首測完成(未送樣)」或「首測完成(已送樣)」狀態，**When** 點擊某個檢驗單，**Then** 系統開啟檢驗單詳情並提供「補充十天後測」功能
3. **Given** 品管人員補充十天後測數據，**When** 在備註欄位填寫品管意見（例如：「樣品保存良好，各項指標符合標準」），**Then** 系統記錄品管人員姓名和意見
4. **Given** 品管人員儲存檢驗單，**When** 查看檢驗單詳情，**Then** 系統顯示填表人（研發人員）和品管人員資訊，區分首測和十天後測的填寫人

---

### Edge Cases

- 當研發人員選擇配方版本時，如果該配方尚未核准，系統如何提示？
- 當檢驗單的首測資料填寫不完整時，是否允許儲存草稿？
- 當十天後測日期早於首測日期時，系統如何驗證並提示？
- 當照片檔案過大（超過 5MB）或格式不支援時，系統如何提示？
- 當多個使用者同時編輯同一檢驗單時，如何處理並發衝突？
- 當檢驗單已標記為「檢驗完成」後，是否允許修改數據？如何記錄修改歷程？
- 當使用者刪除配方版本時，該配方版本關聯的檢驗單如何處理？
- 當品管人員補充十天後測時，研發人員是否收到通知？

## Requirements *(mandatory)*

### Functional Requirements

#### 檢驗單建立與編輯 - 資料結構

系統採用**檢驗單 + 配方關聯**的架構：
- **檢驗單 (Inspection Record)**：包含首測和十天後測的完整檢驗資料
- **配方版本關聯**：每個檢驗單關聯到特定的配方版本（來自配方管理模組）
- **填表人資訊**：記錄填寫首測和十天後測的人員資訊

#### 檢驗單建立與編輯 - 表單欄位

- **FR-001**: 系統必須提供檢驗單建立表單，包含以下結構：

  **【配方選擇】**
  - **配方版本**（必填，下拉選單，僅顯示已核准的配方版本，格式：配方名稱 + 版本號，例如：紅豆湯 v3）
  - 選擇後自動顯示：配方編號、配方名稱、版本號、研發目的

  **【配方建立者資訊】**（系統自動帶入，不可編輯）
  - **配方建立者姓名**（文字，從配方版本資訊自動帶入）
  - **歸屬部門**（文字，從配方版本資訊自動帶入）

  **【首測資訊】**
  - **首測日期**（必填 *，日期選擇器，預設為今日）
  - **檢驗人員**（必填 *，下拉選單，顯示所有研發人員姓名，預設為當前登入使用者）
  - **外觀/重量**（必填 *，文字輸入，最多 200 字元，例如：外觀完整，重量 500g）
  - **濃度 Brix (%)**（必填 *，數字輸入，支援小數點，範圍 0-100，例如：15.5）
  - **酸鹼 PH**（必填 *，數字輸入，支援小數點，範圍 0-14，例如：6.5）
  - **實地口感**（必填 *， range input 滑桿元件 taste-score-range，範圍 1-10，預設 7，即時顯示當前分數）
  - **出水率/固形物**（選填，文字輸入，最多 100 字元，例如：出水率 60%，固形物 40%）
  - **成品飲料測試**（必填 *，多行文字輸入，最多 500 字元，描述沖泡後的口感和表現）
  - **規格**（選填，數字輸入，支援小數點，例如：500）
  - **規格單位**（選填，下拉選單：g/ml）
  - **備註**（選填，多行文字輸入，最多 500 字元）
  - **上傳照片**（選填，支援 JPG/PNG 格式，單張最大 5MB，支援多張上傳）
  - **註：所有必填欄位（標記 * 紅色星號）必須填寫才能儲存**

  **【業務樣本分配】**（選填區塊）
  - **業務樣本分配表格**（動態表格元件 business-sample-table）
    - **業務人員**（必填 *，下拉選單，顯示所有業務人員姓名）
    - **樣本數量**（必填 *，數字輸入，最小值 1，例如：5）
    - **樣本單位**（選填，下拉選單：罐/杯/袋/碗，預設「罐」）
    - **操作**：刪除此列按鈕（目前 UI 已完成，後端實作時啟用）
  - **加入業務按鈕**（目前 UI 已完成，後端實作時啟用動態新增列功能）
  - **送樣按鈕**（顯示在檢驗單詳情頁右上角，綠色按鈕，僅在 is_sampled = false 時顯示）

  **【十天後測資訊】**（首次建立時隱藏，補充時顯示）
  - **十天後測日期**（必填 *，日期選擇器，預設為首測日期 + 10 天）
  - **檢驗人員**（必填 *，下拉選單，顯示所有研發人員姓名，預設為當前登入使用者）
  - **外觀/重量**（必填 *，文字輸入，最多 200 字元）
  - **濃度 Brix (%)**（必填 *，數字輸入，支援小數點，範圍 0-100）
  - **酸鹼 PH**（必填 *，數字輸入，支援小數點，範圍 0-14）
  - **實地口感**（必填 *， range input 滑桿元件 taste-score-range，範圍 1-10，預設 7）
  - **出水率/固形物**（選填，文字輸入，最多 100 字元）
  - **成品飲料測試**（必填 *，多行文字輸入，最多 500 字元）
  - **規格**（選填，數字輸入，支援小數點）
  - **規格單位**（選填，下拉選單：g/ml）
  - **備註**（選填，多行文字輸入，最多 500 字元）
  - **上傳照片**（選填，支援 JPG/PNG 格式，單張最大 5MB，支援多張上傳）
  - **註：所有必填欄位（標記 * 紅色星號）必須填寫才能儲存**

- **FR-002**: 系統必須驗證所有必填欄位（配方版本、首測日期、十天後測日期），未填寫時阻止提交並在欄位旁顯示紅色錯誤提示

- **FR-003**: 系統必須在選擇配方版本時，自動帶入配方基本資訊（配方編號、配方名稱、版本號、研發目的）到表單中（唯讀顯示）

- **FR-004**: 系統必須在建立檢驗單時，自動帶入填表人資訊（姓名、歸屬部門）從當前登入使用者的基本資料

- **FR-005**: 系統必須限制所有照片上傳格式為 JPG 或 PNG，檔案大小不超過 5MB，超過限制時顯示錯誤訊息

- **FR-006**: 系統必須提供照片預覽功能，使用者上傳後可立即查看縮圖，支援刪除和重新上傳

- **FR-007**: 系統必須在補充十天後測時，驗證十天後測日期不得早於首測日期，若違反則顯示紅色錯誤提示

- **FR-008**: 系統必須在檢驗單詳情頁面並排顯示首測和十天後測數據，方便對比（左側首測，右側十天後測）

#### 檢驗單狀態管理

- **FR-009**: 系統必須為檢驗單定義以下**檢測狀態**（共 5 種狀態）：
  - **未檢測** (pending)：檢驗單已建立但尚未填寫首測資料
    - 徽章顏色：灰色 (bg-gray-100, text-gray-700)
  - **首測完成(未送樣)** (initial_completed_no_sample)：已完成首測，尚未送樣，也未補充十天後測
    - 徽章顏色：黃色 (bg-yellow-100, text-yellow-800)
  - **首測完成(已送樣)** (initial_completed_sampled)：已完成首測且已送樣，尚未補充十天後測
    - 徽章顏色：藍色 (bg-blue-100, text-blue-800)
  - **十天檢測完成** (ten_day_completed)：已完成首測和十天後測
    - 徽章顏色：綠色 (bg-green-100, text-green-800)
  - **狀態異常** (abnormal)：檢驗過程中發現異常，需處理
    - 徽章顏色：紅色 (bg-red-100, text-red-800)

- **FR-009-1**: 系統必須提供**送樣狀態**欄位 (is_sampled)：
  - **已送樣** (is_sampled = true)：已送樣給業務，顯示藍色徽章「已送樣」(bg-blue-100, text-blue-800)
  - **未送樣** (is_sampled = false)：尚未送樣，顯示灰色徽章「未送樣」(bg-gray-100, text-gray-600)
  - 送樣狀態顯示在列表頁的「送樣狀態」欄位

- **FR-010**: 系統必須在檢驗單建立時：
  - 若所有必填欄位已填寫且未送樣 (is_sampled = false)，設定狀態為「首測完成(未送樣)」
  - 若所有必填欄位已填寫且已送樣 (is_sampled = true)，設定狀態為「首測完成(已送樣)」
  - 若必填欄位未填寫完整，狀態為「未檢測」

- **FR-011**: 系統必須在補充十天後測資料後，自動更新狀態為「十天檢測完成」

- **FR-012**: 系統必須允許首測完成後直接送樣，不需等待十天後測完成：
  - 在檢驗單詳情頁右上角顯示「送樣」按鈕（綠色 emerald-600，使用 recipes.button 元件 variant="primary"）
  - 「送樣」按鈕僅在 is_sampled = false（未送樣）時顯示
  - 點擊「送樣」按鈕後，可填寫業務樣本分配表格（目前 UI 已完成，後端實作時連接功能）
  - 送樣後，檢驗單狀態從「首測完成(未送樣)」變更為「首測完成(已送樣)」

- **FR-013**: 系統必須在檢驗單狀態為「十天檢測完成」後，限制編輯功能，僅允許查看（除非有特殊權限）

#### 檢驗單列表與查詢

- **FR-014**: 系統必須提供**檢驗單列表頁面**，以表格形式顯示所有檢驗單，包含以下欄位：
  - **全選勾選框**：批次操作用（支援全選功能）
  - **檢驗單編號**：檢驗單編號（例如：#I0001, #I0002），顯示為漸層徽章樣式（紫色到靛藍色漸層）
  - **產品名稱**：關聯的配方名稱（例如：紅豆湯）
  - **版本**：配方版本號（例如：v3），顯示為圓角徽章樣式
  - **製造日期**：製造日期（YYYY-MM-DD 格式），優先顯示 manufacturing_date，若無則回退到 initial_test_date
  - **檢驗員**：檢驗人員姓名
  - **檢測狀態**：檢驗單狀態徽章（未檢測/首測完成(未送樣)/首測完成(已送樣)/十天檢測完成/狀態異常），使用 status-badge 元件 type="inspection"
  - **送樣狀態**：送樣狀態徽章（已送樣/未送樣），根據 is_sampled 欄位顯示，已送樣顯示藍色徽章，未送樣顯示灰色徽章
  - **操作**：圖示按鈕（檢視、編輯、刪除），使用 action-buttons 元件

- **FR-015**: 系統必須在檢驗單列表頂部提供以下操作功能：
  - **搜尋欄位**：搜尋配方名稱或配方建立者（關鍵字搜尋，支援模糊比對）
  - **狀態快速篩選下拉選單**：快速篩選檢測狀態（未檢測/首測完成(未送樣)/首測完成(已送樣)/十天檢測完成/狀態異常）
  - **排序下拉選單**：提供以下排序選項
    - 首測日期 (新→舊)
    - 首測日期 (舊→新)
    - 配方名稱 (A→Z)
    - 配方名稱 (Z→A)
  - **顯示筆數**：顯示當前頁面範圍（例如：顯示 01-10 筆，共 50 筆）
  - **匯出按鈕**：匯出檢驗單資料
  - **新增檢驗單按鈕**：開啟配方選擇畫面

- **FR-016**: 系統必須在檢驗單列表的操作欄提供以下圖示按鈕（使用通用 action-buttons 元件）：
  - **👁 檢視**（藍色）：查看檢驗單詳情（唯讀）
  - **✏ 編輯**（橘色）：編輯檢驗單
  - **🗑 刪除**（紅色）：刪除檢驗單（需彈出確認 Modal）

- **FR-017**: 系統必須支援檢驗單列表的排序功能，提供以下排序選項：
  - 首測日期（新→舊 / 舊→新）
  - 配方名稱（A→Z / Z→A）

- **FR-018**: 系統必須在檢驗單列表採用分頁顯示，每頁顯示 20 筆資料，提供頁碼導航

- **FR-019**: 系統必須提供整合式篩選面板（filter-panel 元件），支援以下篩選條件：
  - 搜尋關鍵字（配方名稱或配方建立者）
  - 檢測狀態篩選（未檢測/首測完成(未送樣)/首測完成(已送樣)/十天檢測完成/狀態異常）
  - 排序方式（首測日期 新→舊/舊→新、配方名稱 A→Z/Z→A）

#### 檢驗單詳情與對比

- **FR-020**: 系統必須提供**檢驗單詳情頁面**，顯示完整檢驗資料，包含：
  - **頂部區域（page-header 元件）**：
    - 檢驗單編號（標題）
    - 狀態徽章（titleBadge slot，顯示 5 種檢測狀態之一）
    - 操作按鈕區（actions slot，右上角）：生成產品規格按鈕、編輯按鈕、送樣按鈕（綠色，僅在 is_sampled = false 時顯示）
  - **基本資料區塊**：配方名稱、版本號、配方建立者、歸屬部門、製造日期、首測日期、檢測狀態
  - **首測資訊區塊**：首測日期、檢驗人員、外觀/重量、Brix、PH、實地口感評分（使用 taste-score-range 元件）、出水率/固形物、成品飲料測試、規格、備註、照片（**不包含檢驗溫度**）
  - **十天後測資訊區塊**：與首測相同結構（**不包含檢驗溫度**）
  - **業務樣本分配區塊**（business-sample-table 元件）：業務人員、樣本數量、樣本單位、操作按鈕
  - **操作按鈕**：送樣按鈕（僅在 is_sampled = false 時顯示）、編輯按鈕

- **FR-021**: 系統必須在檢驗單詳情頁面提供數據對比功能，對於數值欄位（Brix、PH、規格），自動計算差異並顯示變化百分比或差值

- **FR-022**: 系統必須提供檢驗單匯出功能，可將檢驗單資料匯出為 PDF 格式，包含所有文字資料和照片

#### 權限與協同

- **FR-023**: 系統必須限制檢驗單的編輯權限：
  - 首測建立人可以編輯自己的檢驗單（在「草稿」或「首測完成」狀態）
  - 品管人員可以補充任何檢驗單的十天後測資料
  - 研發人員可以查看所有檢驗單
  - 主管可以查看所有檢驗單和匯出 PDF

- **FR-024**: 系統必須在補充十天後測時，記錄補充人員資訊（姓名、部門），與首測填表人區分

- **FR-025**: 系統必須在檢驗單詳情頁面顯示完整的操作歷程，包含：
  - 建立時間和建立人
  - 首測完成時間
  - 十天後測補充時間和補充人
  - 編輯歷程（若有）

#### 介面與互動

- **FR-026**: 系統必須提供響應式介面，支援桌面（1920x1080 以上）和平板（768x1024 以上）裝置使用

- **FR-027**: 系統必須在使用者執行關鍵操作時提供確認提示，包含：
  - 儲存檢驗單：「確定要儲存此檢驗單嗎？」
  - 補充十天後測：「確定要補充十天後測資料嗎？補充後將無法修改首測資料。」
  - 刪除檢驗單：「確定要刪除此檢驗單嗎？此操作無法復原。」

- **FR-028**: 系統必須在操作成功/失敗時提供明確的視覺回饋：
  - 成功：綠色漸層訊息框，左側綠色邊框，從右側滑入動畫，顯示 3 秒後自動消失
  - 失敗：紅色漸層訊息框，左側紅色邊框，需使用者手動關閉
  - 警告：黃色漸層訊息框，左側黃色邊框
  - 資訊：藍色漸層訊息框，左側藍色邊框

- **FR-029**: 系統必須提供麵包屑導航，顯示使用者目前位置（例如：研發模組 > 研發檢驗單）

- **FR-030**: 系統必須支援鍵盤導航（Tab 鍵切換欄位，Enter 鍵提交表單）

- **FR-031**: 系統必須符合 WCAG 2.1 AA 無障礙標準，包含：
  - 所有表單欄位有明確的 label
  - 顏色對比度符合標準（至少 4.5:1）
  - 錯誤訊息可被螢幕閱讀器讀取

- **FR-032**: 系統必須在使用者離開未儲存的表單頁面時，彈出警告提示：「您有未儲存的變更，確定要離開嗎？」

- **FR-033**: 系統必須提供「返回頂部」按鈕，當使用者滾動超過 300px 時自動淡入顯示

#### 視覺設計系統

- **FR-034**: 系統必須採用與配方管理模組一致的設計語言，包含：
  - **顏色系統**：以 Indigo（藍紫）為主色，輔以 Purple、Green、Red、Blue、Amber、Emerald 等色彩
  - **漸層使用**：主要元件使用漸層背景提升視覺層次
  - **圓角規範**：卡片使用 rounded-xl（12px），按鈕和輸入框使用 rounded-lg（8px）
  - **陰影系統**：卡片使用 shadow-md，hover 時升級為 shadow-lg
  - **間距系統**：區塊間距使用 space-y-8，內部間距使用 px-6 py-6

- **FR-035**: 系統必須為每個表單區塊提供以下視覺特性：
  - 白色卡片背景（bg-white），rounded-xl 圓角
  - 左側 4px 彩色邊框（border-l-4），每個區塊使用不同顏色：
    - 配方選擇：Indigo（border-indigo-500）
    - 填表人資訊：Purple（border-purple-500）
    - 首測資訊：Blue（border-blue-500）
    - 十天後測資訊：Emerald（border-emerald-500）
  - 標題區域淡色漸層背景
  - Hover 時陰影加深（shadow-md → shadow-lg）

- **FR-036**: 系統必須為檢驗單列表表格提供以下視覺設計特性：
  - **表格標題列**：漸層背景（bg-gradient-to-r from-indigo-50/50 via-purple-50/30 to-pink-50/20）
  - **表格列 Hover 效果**：漸層效果（hover:bg-gradient-to-r hover:from-indigo-50/40 hover:to-purple-50/30）加上陰影（hover:shadow-sm）
  - **檢驗單編號**：漸層徽章樣式（bg-gradient-to-r from-purple-100 to-indigo-100 text-purple-800 font-mono），帶有 ring 邊框（ring-1 ring-purple-200/50）
  - **版本徽章**：圓角徽章樣式（bg-indigo-100 text-indigo-800，rounded-full）
  - **狀態徽章**：使用通用 status-badge 元件，type='inspection' 啟用檢驗單狀態樣式
  - **操作按鈕**：使用通用 action-buttons 元件（桌面版）和 mobile-action-buttons 元件（手機版）

- **FR-037**: 系統必須為檢驗單詳情頁面的對比區域提供以下視覺特性：
  - 使用左右分欄佈局（grid grid-cols-2 gap-6）
  - 首測區域：左側藍色邊框（border-l-4 border-blue-500）
  - 十天後測區域：右側翠綠色邊框（border-l-4 border-emerald-500）
  - 數值變化顯示：增加用綠色箭頭↑，減少用紅色箭頭↓，不變用灰色橫線 —

#### 元件化設計

- **FR-038**: 系統必須重用配方管理模組的元件，包含：
  - **page-header**：頁面標題元件
  - **button**：按鈕元件
  - **alert**：通知訊息元件
  - **form-field**：表單輸入欄位元件
  - **textarea-field**：多行文字輸入元件
  - **select-field**：下拉選單元件
  - **image-upload**：圖片上傳元件
  - **scroll-to-top**：返回頂部按鈕元件

- **FR-039**: 系統必須建立檢驗單專用的元件，包含：
  - **inspections.list-table**：檢驗單列表表格元件，支援桌面版表格和手機版卡片雙重呈現，包含送樣狀態欄位顯示
  - **inspections.business-sample-table**：業務樣本分配動態表格元件，包含業務人員下拉選單、樣本數量輸入、樣本單位選擇（罐/杯/袋/碗）、刪除列按鈕、加入業務按鈕（UI 已完成，後端實作時啟用動態功能）
  - **inspections.taste-score-range**：實地口感評分滑桿元件（range input，1-10 分，預設 7），即時顯示當前分數，支援 disabled 模式用於詳情頁唯讀顯示
  - **inspections.comparison-view**：首測與十天後測對比檢視元件，左右並排顯示首測和十天後測資料
  - **recipes.recipe-selector**：配方版本選擇元件（共用）
  - **recipes.status-badge**：通用狀態徽章元件，支援 type="inspection" 顯示檢驗單 5 種狀態（未檢測/首測完成(未送樣)/首測完成(已送樣)/十天檢測完成/狀態異常）

- **FR-040**: 所有元件必須支援參數化配置，遵循 Blade 元件規範，使用 `@props` 定義可接受的參數

### Key Entities

- **檢驗單 (Inspection Record)**: 代表單一檢驗紀錄，包含首測和十天後測資料，包含以下屬性：
  - **檢驗單 ID**（自動產生，主鍵）
  - **檢驗單編號**（顯示用編號，格式：#I0001, #I0002...）
  - **配方版本 ID**（關聯到配方管理模組的版本）
  - **配方名稱**（冗餘欄位，方便查詢）
  - **配方版本號**（冗餘欄位，方便查詢）
  - **製造日期**（manufacturing_date，樣品製造日期，YYYY-MM-DD 格式）
  - **檢驗人員 ID**（關聯到使用者，負責檢驗的人員）
  - **檢驗人員姓名**（冗餘欄位，方便查詢）
  - **填表人 ID**（關聯到使用者，首測建立人）
  - **填表人姓名**（冗餘欄位）
  - **歸屬部門**（冗餘欄位）
  - **狀態**（status: pending/initial_completed_no_sample/initial_completed_sampled/ten_day_completed/abnormal）
  - **送樣狀態**（is_sampled: boolean，true=已送樣，false=未送樣）
  - **建立時間**（檢驗單建立時間）
  - **首測資料**（關聯到首測資料實體）
  - **十天後測資料**（關聯到十天後測資料實體，選填）
  - **業務樣本分配**（關聯到業務樣本實體，一對多）
  - **操作歷程**（關聯到操作記錄）

- **首測資料 (Initial Test)**: 代表首次檢測數據，包含以下屬性：
  - **首測 ID**（自動產生，主鍵）
  - **檢驗單 ID**（關聯到檢驗單）
  - **首測日期**（日期）
  - **外觀/重量**（文字，最多 200 字元）
  - **濃度 Brix (%)**（數值，範圍 0-100）
  - **酸鹼 PH**（數值，範圍 0-14）
  - **實地口感**（taste_score: 數值，range input 滑桿，範圍 1-10，預設 7）
  - **出水率/固形物**（文字，最多 100 字元）
  - **成品飲料測試**（多行文字，最多 500 字元）
  - **規格**（數值）
  - **規格單位**（g/ml/罐/杯/袋/碗）
  - **備註**（多行文字，最多 500 字元）
  - **照片 URLs**（JSON，支援多張照片）
  - **註：已移除「檢驗溫度」欄位**

- **十天後測資料 (Ten-Day Test)**: 代表十天後檢測數據，包含以下屬性：
  - **十天後測 ID**（自動產生，主鍵）
  - **檢驗單 ID**（關聯到檢驗單）
  - **十天後測日期**（日期）
  - **補充人 ID**（關聯到使用者，可能是品管人員）
  - **補充人姓名**（冗餘欄位）
  - **外觀/重量**（文字，最多 200 字元）
  - **濃度 Brix (%)**（數值，範圍 0-100）
  - **酸鹼 PH**（數值，範圍 0-14）
  - **實地口感**（taste_score: 數值，range input 滑桿，範圍 1-10，預設 7）
  - **出水率/固形物**（文字，最多 100 字元）
  - **成品飲料測試**（多行文字，最多 500 字元）
  - **規格**（數值）
  - **規格單位**（g/ml/罐/杯/袋/碗）
  - **備註**（多行文字，最多 500 字元）
  - **照片 URLs**（JSON，支援多張照片）
  - **註：已移除「檢驗溫度」欄位**

- **業務樣本 (Business Sample)**: 記錄送樣給業務人員的樣本分配，包含以下屬性：
  - **樣本 ID**（自動產生，主鍵）
  - **檢驗單 ID**（關聯到檢驗單，外鍵）
  - **業務人員 ID**（salesperson_id: 關聯到使用者）
  - **業務人員姓名**（salesperson_name: 冗餘欄位）
  - **樣本數量**（quantity: 數值，必填，最小值 1）
  - **樣本單位**（unit: 字串，可選值：罐/杯/袋/碗，預設「罐」）
  - **建立時間**（時間戳記）

- **操作記錄 (Operation Log)**: 記錄檢驗單的操作歷程，包含以下屬性：
  - **記錄 ID**（自動產生，主鍵）
  - **檢驗單 ID**（關聯到檢驗單）
  - **操作人 ID**（關聯到使用者）
  - **操作類型**（建立/編輯首測/補充十天後測/送樣/刪除）
  - **操作時間**（時間戳記）
  - **操作說明**（文字，描述操作內容）

- **使用者 (User)**: 系統使用者，包含以下屬性：
  - 使用者 ID
  - 姓名
  - 歸屬部門
  - 角色（研發人員/品管人員/主管）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 研發人員能在 3 分鐘內完成檢驗單的建立和首測資料輸入（包含選擇配方、填寫所有必填和選填欄位、上傳照片）
- **SC-002**: 品管人員能在 2 分鐘內補充十天後測資料（包含填寫所有檢測項目和上傳照片）
- **SC-003**: 使用者能在 10 秒內透過篩選功能找到目標檢驗單（在 100+ 檢驗單的資料庫中）
- **SC-004**: 檢驗單詳情頁面的對比功能，使用者能在 5 秒內識別首測和十天後測的數據差異
- **SC-005**: 介面在桌面和平板裝置上的可用性測試通過率達 90% 以上
- **SC-006**: 檢驗單列表頁面載入時間低於 2 秒（包含 100 筆檢驗單資料）
- **SC-007**: 檢驗單詳情頁面載入時間低於 1.5 秒（包含照片）
- **SC-008**: 使用者首次使用系統完成檢驗單建立的成功率達 85% 以上（無需額外培訓或說明文件）
- **SC-009**: 檢驗單篩選結果的準確率達 100%（符合所選條件，無漏失或誤判）
- **SC-010**: 所有關鍵操作（儲存、補充、刪除）的使用者錯誤率低於 5%
- **SC-011**: 照片上傳成功率達 95% 以上（在正常網路環境下）
- **SC-012**: 表單欄位驗證即時回饋時間低於 300ms（使用者輸入後立即顯示錯誤提示）
- **SC-013**: 檢驗單匯出 PDF 功能的成功率達 95% 以上，產出的 PDF 格式正確且包含所有資料

## Assumptions *(documentation)*

### UI/UX 假設

- 假設使用者主要使用桌面或平板裝置，手機版本不在目前範圍內
- 假設檢驗單表單採用單頁表單設計，首測和十天後測在同一頁面顯示（首次建立時十天後測區域隱藏）
- 假設配方版本選擇採用下拉選單方式，支援搜尋功能
- 假設照片上傳採用拖放或點擊選擇方式，上傳後顯示縮圖預覽
- 假設系統提供即時驗證（邊輸入邊驗證），而非僅在提交時驗證
- 假設檢驗單列表頁面顯示所有檢驗單，點擊後進入詳情頁面查看完整資料
- 假設對比功能採用左右分欄佈局，首測在左，十天後測在右

### 業務邏輯假設

- 假設每個檢驗單僅關聯一個配方版本，不支援批次檢驗多個配方
- 假設檢驗單建立後可以編輯首測資料，直到狀態變更為「檢驗完成」
- 假設補充十天後測資料後，首測資料自動鎖定無法修改
- 假設檢驗單歷史紀錄永久保留，無自動刪除機制
- 假設配方版本選擇僅顯示「已核准」狀態的配方版本
- 假設十天後測日期建議為首測日期 + 10 天，但允許使用者自訂
- 假設品管人員可以補充任何檢驗單的十天後測資料，不限於自己建立的檢驗單
- 假設檢驗單刪除需要主管權限或建立人權限

### 欄位邏輯假設

- 假設「外觀/重量」欄位為文字輸入，允許使用者自由描述
- 假設「濃度 Brix (%)」欄位為數字輸入，範圍 0-100，支援小數點
- 假設「酸鹼 PH」欄位為數字輸入，範圍 0-14，支援小數點
- 假設「感官品評」和「成品飲料測試」為多行文字輸入，支援換行
- 假設「規格」和「規格單位」為配對欄位，用於記錄樣品規格（例如：500g）
- 假設「備註」欄位為選填，使用者可填寫任何補充說明
- 假設所有檢測數值欄位（Brix、PH、規格）都是選填，非必填
- 假設日期欄位預設為今日（首測）或首測日期 + 10 天（十天後測），但允許使用者選擇其他日期

### 技術假設

- 假設系統支援現代瀏覽器（Chrome, Firefox, Safari, Edge 最新兩個版本）
- 假設圖片上傳限制為單張 5MB，格式支援 JPG/PNG
- 假設檢驗單列表採用分頁顯示，每頁顯示 20 筆資料
- 假設篩選功能採用前端即時過濾（資料量小於 1000 筆時）或後端 API 查詢（資料量大於 1000 筆時）
- 假設草稿儲存功能使用瀏覽器 localStorage（容量限制 5MB）或伺服器端儲存
- 假設檢驗單匯出 PDF 功能使用伺服器端產生（例如：DomPDF、TCPDF）

### 權限假設

- 假設研發人員可以建立、編輯自己的檢驗單（草稿或首測完成狀態），查看所有檢驗單
- 假設品管人員可以補充任何檢驗單的十天後測資料，查看所有檢驗單
- 假設主管可以查看所有檢驗單、匯出 PDF，但不能直接建立或編輯檢驗單
- 假設系統使用既有的身分驗證機制，不需要額外的登入系統
- 假設使用者角色（研發人員/品管人員/主管）在登入時已確定，無需在介面中切換

### 與配方管理模組的整合假設

- 假設配方管理模組已完成並提供 API 查詢配方版本資料
- 假設檢驗單模組可透過配方版本 ID 查詢配方基本資訊（配方編號、配方名稱、版本號、研發目的）
- 假設配方版本刪除時，關聯的檢驗單不會被刪除，僅標記配方版本為「已刪除」
- 假設配方版本的狀態變更不會影響已建立的檢驗單
